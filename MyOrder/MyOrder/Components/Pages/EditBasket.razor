@using Fluxor
@using Fluxor.Blazor.Web.Components
@using MyOrder.Components.Childs
@using MyOrder.Components.Childs.Header
@using MyOrder.Components.Childs.Lines
@using MyOrder.Shared.Interfaces
@using MyOrder.Store.GeneralInfoUseCase
@using MyOrder.Store.GlobalOperationsUseCase
@using MyOrder.Store.ResourcesUseCase

@inherits FluxorComponent

@page "/{companyId}/EditBasket"

<PageTitle>MyOrder</PageTitle>

@if (!ResourcesState.Value.Initialized)
{
    <MudOverlay Visible="ResourcesState.Value.IsLoading" ZIndex="9999" DarkBackground="false">
        <MudProgressCircular Size="Size.Large" Indeterminate="true" />
    </MudOverlay>
    return;
}

@if (!GeneralInfoState.Value.Initialized)
{
    @* #warning "Refactor to use MudDialog fullscreen with close button false" *@
    <MudOverlay Visible="GeneralInfoState.Value.IsLoading" ZIndex="9999" DarkBackground="false">
        <MudProgressCircular Size="Size.Large" Indeterminate="true" />
    </MudOverlay>
}

<MudContainer Class="pa-8" MaxWidth="MaxWidth.ExtraLarge">
    <MudStack Spacing="4">
        <Notifications />
        <Header />
        <Lines />
        @* <TestComponent /> *@
    </MudStack>
</MudContainer>

@code {
    [Inject]
    private IDispatcher Dispatcher { get; set; } = null!;
    [Inject]
    private IState<ResourcesState> ResourcesState { get; set; } = null!;
    [Inject]
    private IState<GeneralInfoState> GeneralInfoState { get; set; } = null!;
    [Inject]
    private IState<GlobalOperationsState> GlobalOperationsState { get; set; } = null!;
    [Inject]
    private IBasketService BasketService { get; set; } = null!;

    [Parameter]
    public string CompanyId { get; set; } = null!;
    [SupplyParameterFromQuery]
    public string BasketId { get; set; } = null!;

    protected override void OnInitialized()
    {
        BasketService.CompanyId = CompanyId;
        BasketService.BasketId = BasketId;

        Dispatcher.Dispatch(new FetchResourcesAction()); //Refactor
        base.OnInitialized();
    }
}