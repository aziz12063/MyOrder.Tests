@using MyOrder.Services
@using Fluxor
@using MyOrder.Shared.Interfaces
@using MyOrder.Store.ReloadUseCase

@implements IDisposable

@inject IDispatcher Dispatcher
@inject IJSRuntime JSRuntime
@inject IBasketService BasketService
@inject ILogger<F5EventComponent> Logger

@code {
    private DotNetObjectReference<F5EventComponent>? _dotNetHelper;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        _dotNetHelper = DotNetObjectReference.Create(this);
        await JSRuntime.InvokeVoidAsync("registerF5Handler", _dotNetHelper);
        Logger.LogDebug("F5EventComponent initialized");
    }

    [JSInvokable("F5Pressed")]
    public void F5Pressed()
    {
        //TODO: Show a message to the user that the page is being refreshed, with a result of the action
        Dispatcher.Dispatch(new ReloadAction());
        Logger.LogDebug("F5 pressed and action dispatched.");
    }

    public void Dispose()
    {
        if (_dotNetHelper != null)
        {
            _dotNetHelper.Dispose();
            _dotNetHelper = null;
            Logger.LogDebug("_dotNetHelper disposed and set to null in Dispose()");
        }

    }
}