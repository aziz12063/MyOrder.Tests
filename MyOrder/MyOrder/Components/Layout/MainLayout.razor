@using MyOrder.Components.Childs
@using MyOrder.Services
@inherits LayoutComponentBase

@inject NavigationManager NavigationManager
@inject BasketService BasketService

@* Required for MudBlazor framework *@
<MudThemeProvider Theme="@ThemeConfiguration.MyTheme" />
<MudPopoverProvider />

@* Needed for dialogs *@
<MudDialogProvider />

@* Needed for snackbars *@
<MudSnackbarProvider />


<MudLayout>
    <MudAppBar Elevation="2">
        <MudImage Src="images/Raja-Logo.png" Alt="Raja Group" Class="logo" />
        <GeneralInfo />
    </MudAppBar>

    <MudMainContent>
        <ErrorBoundary>
            <ChildContent>
                @Body
            </ChildContent>
            <ErrorContent>
                // Error message
            </ErrorContent>
        </ErrorBoundary>
    </MudMainContent>
</MudLayout>


<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

@code {
    protected override void OnInitialized()
    {
        var uri = new Uri(NavigationManager.Uri);
        var queryParams = System.Web.HttpUtility.ParseQueryString(uri.Query);
        var basketId = queryParams["basketId"];
        if (!string.IsNullOrEmpty(basketId))
        {
            BasketService.BasketId = basketId; // Cache the basket ID in a service
        }
    }
}