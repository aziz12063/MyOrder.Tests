@using Fluxor
@using MyOrder.Store.CreateBasketUseCase
@using MyOrder.Store.GeneralInfoUseCase
@using MyOrder.Store.OrderInfoUseCase
@using MyOrder.Components.Common.Dialogs

@inject IDispatcher dispatcher
@inject IState<GeneralInfoState> generalInfoState
@inject IState<OrderInfoState> orderInfoState
@inject IDialogService DialogService


<MudMenu AnchorOrigin="Origin.BottomCenter"
         TransformOrigin="Origin.TopCenter"
         StartIcon="@Icons.Material.Filled.Add">
    <ActivatorContent>
        <MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Add" Size="Size.Large" />
    </ActivatorContent>
    <ChildContent>
        <MudMenuItem OnClick="OpenNewBasketDialogAsync">Nouveau panier</MudMenuItem>
        @*     <MudMenuItem>
        <MudMenu AnchorOrigin="Origin.CenterRight"
        TransformOrigin="Origin.CenterLeft" EndIcon="@Icons.Material.Filled.ArrowRight" ActivationEvent="MouseEvent.MouseOver">
        <ActivatorContent>
        Nouveau panier à partir de...
        </ActivatorContent>
        <ChildContent>
        <MudMenuItem>Commande de vente</MudMenuItem>
        <MudMenuItem>Devis</MudMenuItem>
        <MudMenuItem>Facture financière</MudMenuItem>
        <MudMenuItem>Commande Web à intégrer</MudMenuItem>
        <MudMenuItem>Détermination dynamique</MudMenuItem>
        </ChildContent>
        </MudMenu>
        </MudMenuItem> *@
        <MudMenuItem OnClick="CloneBasket">Cloner ce panier</MudMenuItem>
        <MudMenuItem>SAV</MudMenuItem>
        <MudMenuItem>FS</MudMenuItem>
    </ChildContent>
</MudMenu>
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Check" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Close" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Mail" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Block" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Menu" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Description" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.LocalBar" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.Warning" Size="Size.Large" />
<MudIconButton Style="color:white;" Icon="@Icons.Material.Filled.ShoppingCart" Size="Size.Large" />

@code {

    string accountId { get; set; }

    private void CloneBasket()
    {
        var basketId = generalInfoState?.Value?.GeneralInfo?.BasketId;
        if (!string.IsNullOrWhiteSpace(basketId))
        {
            dispatcher.Dispatch(
                new CreateBasketAction(new NewBasketRequestDto
                    { BasketId = basketId }));
        }
    }

    private Task OpenNewBasketDialogAsync()
    {
        accountId = orderInfoState?.Value?.BasketOrderInfo?.Account?.Value?.AccountId;
        var options = new DialogOptions { CloseOnEscapeKey = true, FullWidth = true, MaxWidth = MaxWidth.Small };
        var parameters = new DialogParameters<NewBasketDialog>
        {
            { x => x.AccountId, accountId }
        };

        return DialogService.ShowAsync<NewBasketDialog>("Simple Dialog", parameters, options);
    }

    private void NewBasket()
    {
        
    }
}