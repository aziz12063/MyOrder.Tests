@using MyOrder.Store.DeliveryInfoUseCase
@inherits MyOrder.Components.Common.FluxorComponentBase<DeliveryInfoState, FetchDeliveryInfoAction>

@if (isLoading)
{
    <HeaderElementLoadingSkeleton />
    return;
}
<FetchActionTypeCascadingValue FetchActionTypeValue="FetchActionType">
    <MudStack Justify="Justify.SpaceBetween" Style="height: inherit;">
        <div>
            <MudText Typo="Typo.h6" Color="Color.Secondary" Class="pb-4">@BasketDeliveryInfo!.PanelLabel</MudText>
            <!-- Compte de livraison -->
            <CustomHeaderCard>
                <HeaderContent>
                    <MudStack Row="true" Spacing="1" StretchItems="StretchItems.Start" Class="pb-2">
                        <MudText Typo="Typo.subtitle1">@BasketDeliveryInfo!.AccountSectionLabel</MudText>
                        <MudTooltip Text="Chercher compte">
                            <MudIconButton Icon="@Icons.Material.Filled.Search"
                                           Size="Size.Small"
                                           OnClick="OpenAccountSearchDialogAsync" />
                        </MudTooltip>
                        <MudTooltip Text="Modifier l'adresse de livraison">
                            <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                           Size="Size.Small"
                                           OnClick="OpenEditAccountDeliveryAsync" />
                        </MudTooltip>
                        <MudTooltip Text="Copier les informations du client -Not Implemented">
                            <MudIconButton Icon="@Icons.Material.Filled.Description" Size="Size.Small" />
                        </MudTooltip>
                        <MudTooltip Text="Salesforce? -Not Implemented">
                            <MudIconButton Icon="@Icons.Material.Filled.Cloud" Size="Size.Small" />
                        </MudTooltip>
                        <MudTooltip Text="Infos? -Not Implemented">
                            <MudIconButton Icon="@Icons.Material.Filled.Info" Size="Size.Small" />
                        </MudTooltip>
                        <MudTooltip Text="Call? -Not Implemented">
                            <MudIconButton Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                        </MudTooltip>
                    </MudStack>
                </HeaderContent>
                <BodyContent>
                    <GenericMudSelect T="AccountDto"
                                      Field="BasketDeliveryInfo!.Account"
                                      Items="Accounts"
                                      Variant="Variant.Outlined" />

                    <DisplayAddress Address="@DisplayAddress" />
                </BodyContent>
            </CustomHeaderCard>
        </div>

        <!-- Contact  de livraison-->
        <CustomHeaderCard>
            <HeaderContent>
                <MudStack Row="true" Spacing="1" StretchItems="StretchItems.Start">
                    <MudText Typo="Typo.subtitle1">@BasketDeliveryInfo!.ContactSectionLabel</MudText>
                    <MudTooltip Text="Chercher client">
                        <MudIconButton Icon="@Icons.Material.Filled.Search"
                                       Size="Size.Small"
                                       OnClick="OpenContactSearchDialogAsync" />
                    </MudTooltip>
                    <MudTooltip Text="Copier les informations du client -Not Implemented">
                        <MudIconButton Icon="@Icons.Material.Filled.Description" Size="Size.Small" />
                    </MudTooltip>
                    <MudTooltip Text="Salesforce? -Not Implemented">
                        <MudIconButton Icon="@Icons.Material.Filled.Cloud" Size="Size.Small" />
                    </MudTooltip>
                    <MudTooltip Text="Infos? -Not Implemented">
                        <MudIconButton Icon="@Icons.Material.Filled.Info" Size="Size.Small" />
                    </MudTooltip>
                    <MudTooltip Text="Call? -Not Implemented">
                        <MudIconButton Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                    </MudTooltip>
                </MudStack>
            </HeaderContent>
            <BodyContent>
                <GenericMudSelect T="ContactDto"
                                  Field="BasketDeliveryInfo!.Contact"
                                  Items="Contacts"
                                  Variant="Variant.Outlined" />

                <ContactInfo Contact="BasketDeliveryInfo!.Contact?.Value" />
            </BodyContent>
        </CustomHeaderCard>

        <!-- Informations de livraison -->
        <MudStack Spacing="0">
            <MudText Typo="Typo.subtitle1">@BasketDeliveryInfo!.InformationSectionLabel</MudText>

            <GenericMudSelect Field="BasketDeliveryInfo!.DeliveryMode"
                              Items="DeliveryModes"
                              Variant="Variant.Outlined" />

            <GenericCheckBox Field="BasketDeliveryInfo?.CompleteDelivery"
                             Typo="Typo.body2" />

            <DatePicker Field="BasketDeliveryInfo?.ImperativeDate" />

            <DisplayField Field="BasketDeliveryInfo!.OrderDocuments"
                          IsMarkupString="true" />

        </MudStack>
        <MudDivider Style="visibility:hidden;" />

        <!-- Notes de RC -->
        <div>
            <GenericTextField Field="BasketDeliveryInfo!.Note"
                              Lines="3"
                              variant="Variant.Outlined"
                              Typo="Typo.caption" />

            <GenericCheckBox Field="BasketDeliveryInfo?.NoteMustBeSaved"
                             Typo="Typo.caption" />
        </div>
    </MudStack>
</FetchActionTypeCascadingValue>