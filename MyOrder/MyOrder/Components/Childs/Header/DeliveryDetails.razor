@using MyOrder.Store.DeliveryInfoUseCase

@inherits BaseFluxorComponent<DeliveryInfoState, FetchDeliveryInfoAction>

@if (State.Value.IsLoading)
{
    <HeaderElementLoadingSkeleton />
    return;
}

<MudContainer Class="pa-0">
    <MudStack Spacing="4">
        <MudText Typo="Typo.h6" Color="Color.Secondary">Livraison</MudText>

        <!-- Compte Livraison -->
        <MudStack Spacing="2">
            <MudStack Row="true" Spacing="1" StretchItems="StretchItems.Start">
                <MudText Typo="Typo.subtitle1">@BasketDeliveryInfo.Account.Name</MudText>
                <MudTooltip Text="Chercher client? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Search" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Copier les informations du client -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Description" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Salesforce? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Cloud" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Infos? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Info" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Call? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                </MudTooltip>
            </MudStack>

            @if (AccountAddress != null && AccountAddress is { Count: > 0 })
            {
                <MudTooltip RootStyle="width: 100%;" Duration="1000">
                    <ChildContent>
                        <MudText Typo="Typo.body2" Class="compact-client-details">@SelectedAccount</MudText>
                    </ChildContent>
                    <TooltipContent>
                        @for (var i = 0; i < AccountAddress.Count - 2; i++)
                        {
                            var x = i;
                            <MudText Typo="Typo.caption">@AccountAddress[x]</MudText>
                            <br />
                        }
                        @if (AccountAddress.Count > 1)
                        {
                            <MudText Typo="Typo.caption">@AccountAddress[AccountAddress.Count() - 2]</MudText>
                            <br />
                            <MudText Typo="Typo.caption">@AccountAddress[^1]</MudText>
                        }
                        else
                        {
                            <MudText Typo="Typo.caption">@AccountAddress[^1]</MudText>
                        }
                    </TooltipContent>
                </MudTooltip>
            }
            else
            {
                <MudText Typo="Typo.body2" Class="compact-client-details">@SelectedAccount</MudText>
            }
            
            <MudTextField Typo="Typo.caption"
                          Lines="5"
                          Variant="Variant.Outlined"
                          FullWidth="true"
                          Margin="Margin.Dense"
                          ReadOnly="true"
                          Value="DisplayAddress" />

            
            <!-- Contact Livraison -->

            <MudSelect Typo="Typo.body2"
                       Label="@BasketDeliveryInfo.Contact.Name"
                       Margin="Margin.Dense"
                       Dense="true"
                       Variant="Variant.Outlined"
                       FullWidth="true"
                       AnchorOrigin="Origin.CenterCenter"
                       Required="@FieldUtility.IsRequired(@BasketDeliveryInfo.Contact)"
                       ReadOnly="@FieldUtility.IsReadOnly(BasketDeliveryInfo.Contact)"
                       T="ContactDto"
                       @bind-Value="ContactValue">
                @foreach (var item in @Contacts)
                {
                    <MudSelectItem T="ContactDto" Value="@item">@item</MudSelectItem>
                }
            </MudSelect>

            <MudGrid Spacing="2">
                <MudItem xs="12" sm="6">
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                        <MudIcon Title="Téléphone" Icon="@Icons.Material.Filled.Phone" Color="Color.Success" Size="Size.Small" />
                        <MudText Typo="Typo.body2">@FieldUtility.NullOrWhiteSpaceHelper(BasketDeliveryInfo?.Contact?.Value?.Phone)</MudText>
                    </MudStack>
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                        <MudIcon Title="Mobile" Icon="@Icons.Material.Filled.PhoneIphone" Color="Color.Info" Size="Size.Small" />
                        <MudText Typo="Typo.body2">@FieldUtility.NullOrWhiteSpaceHelper(BasketDeliveryInfo?.Contact?.Value?.CellularPhone)</MudText>
                    </MudStack>
                </MudItem>
                <MudItem xs="12">
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                        <MudIcon Title="Email" Icon="@Icons.Material.Filled.Email" Color="Color.Surface" Size="Size.Small" />
                        <MudText Typo="Typo.body2">@FieldUtility.NullOrWhiteSpaceHelper(BasketDeliveryInfo?.Contact?.Value?.Email)</MudText>
                    </MudStack>
                </MudItem>
            </MudGrid>
        </MudStack>
        

        <!-- Notes de RC -->
        <MudTextField Typo="Typo.caption"
                      Lines="4"
                      Variant="Variant.Outlined"
                      FullWidth="true"
                      Margin="Margin.Dense"
                      Required="@FieldUtility.IsRequired(@BasketDeliveryInfo.Contact)"
                      ReadOnly="@FieldUtility.IsReadOnly(BasketDeliveryInfo.Contact)"
                      Label="@BasketDeliveryInfo.Note.Name"
                      Value="@NoteValue" />
    </MudStack>
</MudContainer>