@using MyOrder.Store.DeliveryInfoUseCase

@inherits FluxorComponentBase<NewDeliveryAccountState, FetchNewDeliveryAccountAction>

<MudDialog Class="app-dialog-modal">
    <TitleContent>
        <MudText Typo="Typo.h5">Édition de l'adresse de livraison</MudText>
    </TitleContent>
    <DialogContent>
        @if (_isLoading)
        {
            <MudProgressLinear Color="Color.Primary"
                               Indeterminate="true" />
            <MudText>Chargement ...</MudText>
        }
        else
        {
            <MudGrid Spacing="1"
                     Class="py-1">
                <MudItem xs="4">
                    <MudPaper Elevation="2" Class="header-cards-height header-cards-height-content">
                        <MudText Typo="Typo.h6" Color="Color.Secondary" Class="pb-4">@DeliveryAccountDraft!.AccountSectionLabel</MudText>
                        <MudGrid Spacing="2">
                            @if (!FieldUtility.IsHidden(DeliveryAccountDraft?.AccountId))
                            {
                                <MudItem xs="4">
                                    <GenericTextField Field="DeliveryAccountDraft!.AccountId" />
                                </MudItem>
                            }
                            <MudItem xs="8">
                                <GenericTextField Field="DeliveryAccountDraft!.Name" />
                            </MudItem>
                            <MudItem xs="12">
                                <GenericTextField Field="DeliveryAccountDraft!.Recipient" />
                            </MudItem>
                        </MudGrid>
                    </MudPaper>
                </MudItem>
                <MudItem xs="8">
                    <MudPaper Elevation="2" Class="header-cards-height header-cards-height-content">
                        <MudText Typo="Typo.h6" Color="Color.Secondary" Class="pb-4">@DeliveryAccountDraft!.AddressSectionLabel</MudText>
                        <MudGrid Spacing="3">
                            <MudItem xs="6">
                                <GenericTextField Field="DeliveryAccountDraft!.Building" />
                            </MudItem>
                            <MudItem xs="6">
                                <GenericTextField Field="DeliveryAccountDraft!.Street" />
                            </MudItem>
                            <MudItem xs="6">
                                <GenericTextField Field="DeliveryAccountDraft!.Locality" />
                            </MudItem>
                            <MudItem xs="6">
                                <MudGrid Spacing="1">
                                    <MudItem xs="3">
                                        <GenericTextField Field="DeliveryAccountDraft!.Zipcode" />
                                    </MudItem>
                                    <MudItem xs="5">
                                        <GenericTextField Field="DeliveryAccountDraft!.City" />
                                    </MudItem>
                                    <MudItem xs="4">
                                        <GenericTextField Field="DeliveryAccountDraft!.Country" />
                                    </MudItem>
                                </MudGrid>

                            </MudItem>

                        </MudGrid>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12">
                    <MudDataGrid T="Address"
                                 Elevation="2"
                                 Bordered="true"
                                 Dense="true"
                                 Striped="true"
                                 FixedHeader="true"
                                 Height="30vh"
                                 Virtualize="true"
                                 Items="DeliveryAccountDraft!.AddressLookupResults"
                                 SortMode="@SortMode.None">
                        <ToolBarContent>
                            <BasketFieldText TextField="DeliveryAccountDraft!.StatusMessage" />
                            <MudSpacer />
                            <ProcedureCallButton Field="DeliveryAccountDraft!.Actions?.EditMode"
                                                 Icon="@Icons.Material.Filled.EditLocation" />
                            <ProcedureCallButton Field="DeliveryAccountDraft!.Actions?.AddressLookup"
                                                 Icon="@Icons.Material.Filled.LocationSearching" />
                        </ToolBarContent>
                        <Columns>
                            <TemplateColumn CellStyle="width:2%">
                                <CellTemplate>
                                    <ProcedureCallButton Field="context.Item.IsSelected"
                                                         Color="Color.Primary"
                                                         IconOnly="true"
                                                         Icon="@Icons.Material.Filled.KeyboardDoubleArrowRight" />
                                </CellTemplate>
                            </TemplateColumn>
                            <PropertyColumn Title="Bat ZI"
                                            Property="item => item.Building ?? string.Empty" />

                            <PropertyColumn Title="Voie"
                                            CellStyle="min-width:30%"
                                            Property="item => item.Street ?? string.Empty" />

                            <PropertyColumn Title="Lieu dit"
                                            Property="item => item.Locality ?? string.Empty" />

                            <PropertyColumn Title="CP"
                                            Property="item => item.ZipCode ?? string.Empty" />

                            <PropertyColumn Title="Ville"
                                            Property="item => item.City ?? string.Empty" />

                            <PropertyColumn Title="Pays"
                                            Property="item => item.Country ?? string.Empty" />
                        </Columns>
                    </MudDataGrid>
                </MudItem>
            </MudGrid>
        }
    </DialogContent>
    <DialogActions>
        @if (_isLoading)
            return;

        <ProcedureCallButton Field="DeliveryAccountDraft!.Actions?.AddAddress"
                             Icon="@Icons.Material.Filled.Add"
                             Size="Size.Medium"
                             OnClickCallback="OnSaveClicked" />
    </DialogActions>
</MudDialog>