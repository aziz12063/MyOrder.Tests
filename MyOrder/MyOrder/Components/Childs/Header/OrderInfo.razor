@using MyOrder.Store.OrderInfoUseCase
@inherits BaseFluxorComponent<OrderInfoState, FetchOrderInfoAction>

@if (State.Value.IsLoading)
{
    <HeaderElementLoadingSkeleton />
    return;
}

@{
    if (BasketOrderInfo == null)
    {
        <LogAndAlert LogLevel="LogLevel.Error"
                     Exception="new NullReferenceException()"
                     StackTrace="@LogUtility.GetStackTrace()"
                     LogMessage="Unexpected null for BasketOrderInfo object."
                     AlertMessage="Une erreur est survenue..." />
        return;
    }
}

<MudContainer Class="pa-0">
    <MudStack Spacing="4">
        <MudText Typo="Typo.h6" Color="Color.Secondary">Commande</MudText>

        <!-- Contact Client -->
        <MudStack Spacing="2">
            <MudStack Row="true" Spacing="1" StretchItems="StretchItems.Start">
                <MudText Typo="Typo.subtitle1">@BasketOrderInfo.Account?.Name</MudText>
                <MudTooltip Text="Chercher client? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Search" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Copier les informations du client -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Description" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Salesforce? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Cloud" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Infos? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Info" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Call? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                </MudTooltip>
            </MudStack>
            
            <AddressTooltip AccountAddress="AccountAddress">
                <MudText Typo="Typo.body2" Class="compact-client-details">@SelectedClient</MudText>
            </AddressTooltip>
            
            @if (!FieldUtility.IsHidden(BasketOrderInfo.Contact))
            {
                <MudSelect Typo="Typo.body2"
                           Label="@BasketOrderInfo.Contact?.Name"
                           Margin="Margin.Dense"
                           Dense="true"
                           Variant="Variant.Outlined"
                           FullWidth="true"
                           AnchorOrigin="Origin.CenterCenter"
                           Required="@FieldUtility.IsRequired(BasketOrderInfo.Contact)"
                           ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.Contact)"
                           T="ContactDto"
                           @bind-value="@ContactValue">
                    @if (Contacts is not null)
                    {
                        foreach (var item in Contacts)
                        {
                            <MudSelectItem T="ContactDto" Value="@item">@item</MudSelectItem>
                        }
                    }
                </MudSelect>
            }

            <MudGrid Spacing="2">
                <MudItem xs="12" sm="6">
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                        <MudIcon Title="Téléphone" Icon="@Icons.Material.Filled.Phone" Color="Color.Success" Size="Size.Small" />
                        <MudText Typo="Typo.body2">@FieldUtility.NullOrWhiteSpaceHelperWithDash(BasketOrderInfo.Contact?.Value?.Phone)</MudText>
                    </MudStack>
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                        <MudIcon Title="Mobile" Icon="@Icons.Material.Filled.PhoneIphone" Color="Color.Info" Size="Size.Small" />
                        <MudText Typo="Typo.body2">@FieldUtility.NullOrWhiteSpaceHelperWithDash(BasketOrderInfo.Contact?.Value?.CellularPhone)</MudText>
                    </MudStack>
                </MudItem>
                <MudItem xs="12">
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                        <MudIcon Title="Email" Icon="@Icons.Material.Filled.Email" Color="Color.Surface" Size="Size.Small" />
                        <MudText Typo="Typo.body2">@FieldUtility.NullOrWhiteSpaceHelperWithDash(BasketOrderInfo.Contact?.Value?.Email)</MudText>
                    </MudStack>
                </MudItem>
            </MudGrid>
        </MudStack>

        <!-- Secteur d'activité -->
        <MudStack Spacing="1">
            <MudText Typo="Typo.subtitle1">@BasketOrderInfo.ActivityArea?.Name</MudText>
            <MudTooltip Text="@FieldUtility.NullOrWhiteSpaceHelperWithDash(BasketOrderInfo.ActivityArea?.Description)">
                <MudText Typo="Typo.body2">@FieldUtility.NullOrWhiteSpaceHelperWithDash(BasketOrderInfo.ActivityArea?.Value)</MudText>
            </MudTooltip>
            @if (BasketOrderInfo.CustomerTags is { Count: > 0 })
            {
                <MudStack Row="true" Spacing="3" Justify="Justify.FlexStart">
                    @foreach (var item in BasketOrderInfo.CustomerTags)
                    {
                        if (item is not null)
                        {
                            <MudTooltip Text="@FieldUtility.NullOrWhiteSpaceHelperWithDash(item.Description)">
                                <MudIcon Color="@CustomerTagColorHelper(item.Value)" Icon="@CustomerTagIconHelper(item.Value)" Size="Size.Large" />
                            </MudTooltip>
                        }
                    }
                </MudStack>
            }
        </MudStack>

        <!-- Informations générales -->
        <MudStack Spacing="2">
            <MudText Typo="Typo.subtitle1">Informations générales</MudText>
            <MudGrid Spacing="2">
                <MudStack Row="true" Justify="Justify.SpaceEvenly">
                    <MudItem>
                        <MudSelect Typo="Typo.body2"
                                   Label="@BasketOrderInfo.SalesOriginId?.Name"
                                   Margin="Margin.Dense"
                                   Dense="true"
                                   FullWidth="true"
                                   Required="@FieldUtility.IsRequired(BasketOrderInfo.SalesOriginId)"
                                   ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.SalesOriginId)"
                                   @bind-Value="SalesOriginIdValue">
                            @if (SalesOrigins is not null)
                            {
                                foreach (var item in SalesOrigins)
                                {
                                    if (item is not null)
                                    {
                                        <MudSelectItem Value="@item.Value"/>
                                    }
                                }
                            }
                        </MudSelect>
                    </MudItem>
                    <MudItem>
                        <MudSelect Typo="Typo.body2"
                                   Margin="Margin.Dense"
                                   Dense="true"
                                   FullWidth="true"
                                   Label="@BasketOrderInfo.WebOriginId?.Name"
                                   Required="@FieldUtility.IsRequired(BasketOrderInfo.WebOriginId)"
                                   ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.WebOriginId)"
                                   Disabled="@FieldUtility.IsHidden(BasketOrderInfo.WebOriginId)"
                                   @bind-Value="WebOriginIdValue">
                            @if (WebOrigins is not null)
                            {
                                foreach (var item in WebOrigins)
                                {
                                    if (item is not null)
                                    {
                                        <MudSelectItem Value="@item.Value"/>
                                    }
                                }
                            }
                        </MudSelect>
                    </MudItem>
                </MudStack>
                <MudItem xs="12" sm="12">
                    <MudSelect Typo="Typo.body2"
                               FullWidth="true"
                               Margin="Margin.Dense"
                               Dense="true"
                               Label="@BasketOrderInfo.SalesPoolId?.Name"
                               Required="@FieldUtility.IsRequired(BasketOrderInfo.SalesPoolId)"
                               ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.SalesPoolId)"
                               Disabled="@FieldUtility.IsHidden(BasketOrderInfo.SalesPoolId)"
                               @bind-Value="SalesPoolId">
                        @if (SalesPools is not null)
                        {
                            foreach (var item in SalesPools)
                            {
                                if (item is not null && !string.IsNullOrWhiteSpace(item.Value))
                                {
                                    <MudSelectItem Value="@(item.Value + " - " + item.Description)"/>
                                }
                            }
                        }
                    </MudSelect>
                </MudItem>
                <MudItem xs="12" sm="12">
                    <MudTextField T="string"
                                  Typo="Typo.body2"
                                  Margin="Margin.Dense"
                                  Label="@BasketOrderInfo.CustomerOrderRef?.Name"
                                  Required="@FieldUtility.IsRequired(BasketOrderInfo.CustomerOrderRef)"
                                  ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.CustomerOrderRef)"
                                  Disabled="@FieldUtility.IsHidden(BasketOrderInfo.CustomerOrderRef)"
                                  @bind-Value="CustomerOrderRefValue" />
                </MudItem>
                <MudItem xs="12" sm="12">
                    <MudTextField Typo="Typo.body2"
                                  Margin="Margin.Dense"
                                  Variant="Variant.Text"
                                  Label="@BasketOrderInfo.WebSalesId?.Name"
                                  Required="@FieldUtility.IsRequired(BasketOrderInfo.WebSalesId)"
                                  ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.WebSalesId)"
                                  Disabled="@FieldUtility.IsHidden(BasketOrderInfo.WebSalesId)"
                                  @bind-Value="WebSalesIdValue" />
                </MudItem>
            </MudGrid>
        </MudStack>

        <!-- Related Link-->
        @if (!FieldUtility.IsHidden(BasketOrderInfo.RelatedLink))
        {
            <MudTextField Typo="Typo.body2"
                          Margin="Margin.Dense"
                          Variant="Variant.Text"
                          FullWidth="true"
                          Required="@FieldUtility.IsRequired(BasketOrderInfo.RelatedLink)"
                          ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.RelatedLink)"
                          Label="@BasketOrderInfo.RelatedLink?.Name"
                          @bind-Value="@RelatedLinkValue" />
        }

        <!-- Notes de RC -->
        <MudTextField Typo="Typo.caption"
                      Lines="4"
                      Variant="Variant.Outlined"
                      FullWidth="true"
                      Margin="Margin.Dense"
                      ReadOnly="true"
                      Label="@BasketOrderInfo.Note?.Name"
                      Value="@BasketOrderInfo.Note?.Value" />
    </MudStack>
</MudContainer>