@using MyOrder.Store.OrderInfoUseCase
@inherits BaseFluxorComponent<OrderInfoState, FetchOrderInfoAction>

@if (State.Value.IsLoading)
{
    <HeaderElementLoadingSkeleton />
    return;
}
<MudStack Justify="Justify.SpaceBetween" Style="height: inherit;">

    <div>
        <MudText Typo="Typo.h6" Color="Color.Secondary" Class="pb-4">Commande</MudText>

        <!-- Contact Client -->
        <CustomHeaderCard>
            <HeaderContent>
                <MudText Typo="Typo.subtitle1">Contact Commandeur</MudText>
                <MudTooltip Text="Chercher client? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Search" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Copier les informations du client -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Description" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Salesforce? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Cloud" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Infos? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Info" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Call? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                </MudTooltip>
            </HeaderContent>
            <BodyContent>
                <AddressTooltip AccountAddress="AccountAddress">
                    <MudTextField Typo="Typo.body2"
                                  Variant="Variant.Outlined"
                                  Margin="Margin.Dense"
                                  ReadOnly="true"
                                  Value="SelectedClient"
                                  Label="Compte Commandeur"
                                  Style="text-align-last: center;" />

                </AddressTooltip>

                <GenericMudSelect Variant="Variant.Outlined"
                                  T="ContactDto"
                                  @bind-BoundValue="ContactValue"
                                  Field="BasketOrderInfo!.Contact"
                                  Items="Contacts" />

                <ContactInfo Contact="BasketOrderInfo!.Contact?.Value" />
            </BodyContent>
        </CustomHeaderCard>
    </div>

    <!-- Informations générales -->
    <MudCard Elevation="0" Class="pa-2" Style="background-color: transparent;">
        <MudCardHeader Class="px-1 py-2 ma-n1">
            <CardHeaderContent>
                <MudText Typo="Typo.subtitle1">Informations générales</MudText>
            </CardHeaderContent>
            <CardHeaderActions>
                @if (BasketOrderInfo?.CustomerTags is { Count: > 0 })
                {
                    <MudStack Row="true" Spacing="3" Justify="Justify.FlexStart">
                        @foreach (var item in BasketOrderInfo.CustomerTags)
                        {
                            if (item is not null)
                            {
                                <MudTooltip Text="@FieldUtility.NullOrWhiteSpaceHelperWithDash(item.Description)">
                                    <MudIcon Color="@CustomerTagColorHelper(item.Value)" Icon="@CustomerTagIconHelper(item.Value)" Size="Size.Large" />
                                </MudTooltip>
                            }
                        }
                    </MudStack>
                }
            </CardHeaderActions>
        </MudCardHeader>
        <MudCardContent Class="pa-0">
            <MudStack Spacing="2">

                <MudTextField Typo="Typo.body2"
                              Class="px-0"
                              Label="@BasketOrderInfo!.ActivityArea?.Name"
                              Value="FieldUtility.NullOrWhiteSpaceHelperWithDash(BasketOrderInfo!.ActivityArea?.Value)"
                              ReadOnly="true"
                              Disabled="string.IsNullOrWhiteSpace(BasketOrderInfo!.ActivityArea?.Value)"
                              Variant="Variant.Outlined"
                              Margin="Margin.Dense"
                              HelperText="@FieldUtility.NullOrWhiteSpaceHelperWithDash(BasketOrderInfo!.ActivityArea?.Description)" />



                <MudGrid Spacing="1">
                    <MudItem xs="12">
                        <MudGrid Justify="Justify.SpaceBetween">
                            <MudItem xs="6">
                                <GenericMudSelect T="string"
                                                  @bind-BoundValue="SalesOriginIdValue"
                                                  Field="BasketOrderInfo!.SalesOriginId"
                                                  Items="SalesOrigins?.Select( item => item?.Value).ToList()" />

                            </MudItem>
                            <MudItem xs="6">
                                <GenericMudSelect T="string"
                                                  @bind-BoundValue="WebOriginIdValue"
                                                  Field="BasketOrderInfo!.WebOriginId"
                                                  Items="WebOrigins?.Select( item => item?.Value).ToList()" />
                            </MudItem>
                        </MudGrid>
                    </MudItem>
                    <MudItem xs="12">
                        <GenericMudSelect T="string"
                                          @bind-BoundValue="SalesPoolId"
                                          Field="BasketOrderInfo!.SalesPoolId"
                                          Items="SalesPools?.Select( item => item?.Value).ToList()" />

                    </MudItem>
                    <!-- Customer Ref-->
                    <MudItem xs="12">
                        <MudTextField T="string"
                                      Typo="Typo.body2"
                                      Margin="Margin.Dense"
                                      Variant="Variant.Text"
                                      Class="input-background"
                                      Label="@BasketOrderInfo!.CustomerOrderRef?.Name"
                                      Required="@FieldUtility.IsRequired(BasketOrderInfo.CustomerOrderRef)"
                                      ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.CustomerOrderRef)"
                                      Disabled="@FieldUtility.IsHidden(BasketOrderInfo.CustomerOrderRef)"
                                      @bind-Value="CustomerOrderRefValue" />
                    </MudItem>
                    <!-- Web Sales-->
                    <MudItem xs="12">
                        <MudTextField Typo="Typo.body2"
                                      Margin="Margin.Dense"
                                      Variant="Variant.Text"
                                      Class="input-background"
                                      Label="@BasketOrderInfo!.WebSalesId?.Name"
                                      Required="@FieldUtility.IsRequired(BasketOrderInfo.WebSalesId)"
                                      ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.WebSalesId)"
                                      Disabled="@FieldUtility.IsHidden(BasketOrderInfo.WebSalesId)"
                                      @bind-Value="WebSalesIdValue" />
                    </MudItem>
                    <!-- Related Link-->
                    <MudItem xs="12">
                        @if (!FieldUtility.IsHidden(BasketOrderInfo!.RelatedLink))
                        {
                            <MudTextField Typo="Typo.body2"
                                          Margin="Margin.Dense"
                                          Variant="Variant.Text"
                                          FullWidth="true"
                                          Required="@FieldUtility.IsRequired(BasketOrderInfo.RelatedLink)"
                                          ReadOnly="@FieldUtility.IsReadOnly(BasketOrderInfo.RelatedLink)"
                                          Label="@BasketOrderInfo.RelatedLink?.Name"
                                          @bind-Value="@RelatedLinkValue" />
                        }
                    </MudItem>
                </MudGrid>
            </MudStack>
        </MudCardContent>
    </MudCard>


    <MudDivider />

    <!-- SUBSECTION : Notes de RC -->
    <div>
        <MudTextField Typo="Typo.caption"
                      Lines="4"
                      Variant="Variant.Filled"
                      FullWidth="true"
                      Margin="Margin.Dense"
                      ReadOnly="true"
                      Label="@BasketOrderInfo.Note?.Name"
                      Value="@BasketOrderInfo.Note?.Value" />
    </div>
</MudStack>