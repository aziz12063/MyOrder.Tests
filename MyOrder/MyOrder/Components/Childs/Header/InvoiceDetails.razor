@using MyOrder.Store.InvoiceInfoUseCase

@inherits MyOrder.Components.Common.BaseFluxorComponent<InvoiceInfoState, FetchInvoiceInfoAction>

@if (State.Value.IsLoading)
{
    <HeaderElementLoadingSkeleton />
    return;
}

<MudContainer Class="pa-0">
    <MudStack Spacing="4">
        <MudText Typo="Typo.h6" Color="Color.Secondary">Facturation</MudText>

        <!--Compte facturé-->
        <MudStack Spacing="2">
            <MudStack Row="true" Spacing="1" StretchItems="StretchItems.Start">
                <MudText Typo="Typo.subtitle1">@BasketInvoiceInfo!.Account?.Name</MudText>
                <MudTooltip Text="Chercher client? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Search" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Copier les informations du client -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Description" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Salesforce? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Cloud" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Infos? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Info" Size="Size.Small" />
                </MudTooltip>
                <MudTooltip Text="Call? -Not Implemented">
                    <MudIconButton Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
                </MudTooltip>
            </MudStack>

            <GenericMudSelect T="AccountDto"
                              Field="BasketInvoiceInfo!.Account"
                              Items="InvoiceToAccounts"
                              @bind-BoundValue="AccountValue"
                              Variant="Variant.Outlined" />

            <MudTextField Typo="Typo.caption"
                          Lines=" AccountAddress != null? AccountAddress.Count : 1"
                          Variant="Variant.Outlined"
                          FullWidth="true"
                          Margin="Margin.Dense"
                          ReadOnly="true"
                          Value="DisplayAddress" />

            <!--Siret-->
            @if (!FieldUtility.IsHidden(BasketInvoiceInfo!.SiretId))
            {
                <MudItem>
                    <MudTextField Typo="Typo.body2"
                                  Margin="Margin.Dense"
                                  Variant="Variant.Text"
                                  FullWidth="true"
                                  ReadOnly="@FieldUtility.IsReadOnly(BasketInvoiceInfo.SiretId)"
                                  Disabled="@FieldUtility.IsDisabled(BasketInvoiceInfo.SiretId)"
                                  Label="@BasketInvoiceInfo.SiretId?.Name"
                                  Value="@BasketInvoiceInfo.SiretId?.Value" />
                </MudItem>
            }

            <!--Groupe de taxe-->
            <GenericMudSelect T="string"
                              Field="BasketInvoiceInfo!.TaxGroup"
                              Items="TaxGroups?.Select( item => item?.Value).ToList()"
                              @bind-BoundValue="TaxGroupValue"
                              Variant="Variant.Outlined" />
        </MudStack>


        <!--Paiment du client-->
        <MudStack Spacing="2">
            <MudText Typo="Typo.subtitle1">Paiement du client</MudText>
            @if (!FieldUtility.IsHidden(BasketInvoiceInfo!.PaymentTerm))
            {
                <MudItem>
                    <MudTextField Typo="Typo.body2"
                                  Margin="Margin.Dense"
                                  Variant="Variant.Text"
                                  FullWidth="true"
                                  ReadOnly="@FieldUtility.IsReadOnly(BasketInvoiceInfo.PaymentTerm)"
                                  Disabled="@FieldUtility.IsDisabled(BasketInvoiceInfo.PaymentTerm)"
                                  Label="@BasketInvoiceInfo.PaymentTerm?.Name"
                                  Value="@BasketInvoiceInfo.PaymentTerm?.Value" />
                </MudItem>
            }
            <MudItem>
                <GenericMudSelect T="string"
                                  @bind-BoundValue="PaymentModeValue"
                                  Field="BasketInvoiceInfo!.PaymentMode"
                                  Items="PaymentModes?.Select( item => item?.Value).ToList()" />

            </MudItem>
        </MudStack>

        <!--Entities public/Chorus-->
        <MudStack Spacing="2">
            <MudText Typo="Typo.subtitle1">Entités publiques / Chorus</MudText>
            <MudItem>
                <MudCheckBox Dense="true"
                             Style="display:inline-block;"
                             Label="Entité publique (Not Implemented)"
                             LabelPosition="LabelPosition.Start"
                             Disabled="true"
                             Value="IsPublicEntityValue" />
            </MudItem>
            @if (!FieldUtility.IsHidden(BasketInvoiceInfo!.PublicEntityExecutingService))
            {
                <MudItem>
                    <MudTextField Typo="Typo.body2"
                                  Margin="Margin.Dense"
                                  Variant="Variant.Text"
                                  FullWidth="true"
                                  ReadOnly="@FieldUtility.IsReadOnly(BasketInvoiceInfo!.PublicEntityExecutingService)"
                                  Disabled="@FieldUtility.IsDisabled(BasketInvoiceInfo!.PublicEntityExecutingService)"
                                  Label="@BasketInvoiceInfo!.PublicEntityExecutingService?.Name"
                                  @bind-Value="PublicEntityExecutingServiceValue" />
                </MudItem>
            }
            @if (!FieldUtility.IsHidden(BasketInvoiceInfo!.PublicEntityLegalCommitment))
            {
                <MudItem>
                    <MudTextField Typo="Typo.body2"
                                  Margin="Margin.Dense"
                                  Variant="Variant.Text"
                                  FullWidth="true"
                                  ReadOnly="@FieldUtility.IsReadOnly(BasketInvoiceInfo!.PublicEntityLegalCommitment)"
                                  Disabled="@FieldUtility.IsDisabled(BasketInvoiceInfo!.PublicEntityLegalCommitment)"
                                  Label="@BasketInvoiceInfo!.PublicEntityLegalCommitment?.Name"
                                  @bind-Value="@PublicEntityLegalCommitmentValue" />
                </MudItem>
            }
        </MudStack>

        <!--Notes de facturation-->
        <MudTextField Typo="Typo.caption"
                      Lines="4"
                      Variant="Variant.Filled"
                      FullWidth="true"
                      Margin="Margin.Dense"
                      ReadOnly="true"
                      Label="@BasketInvoiceInfo!.Note?.Name"
                      Value="@BasketInvoiceInfo!.Note?.Value" />
    </MudStack>
</MudContainer>