@using MyOrder.Store.LinesUseCase
@using static MudBlazor.CategoryTypes
@inherits MyOrder.Components.Common.BaseFluxorComponent<LinesState, FetchLinesAction>

@if (State.Value.IsLoading)
{
    <HeaderElementLoadingSkeleton />
    return;
}
<MudContainer Class="pa-0 ma-0" Style="max-width: none;">
    <!--Grid-->
    <MudDataGrid T="BasketLineDto"
                 Bordered="true"
                 Dense="true"
                 Hover="true"
                 Striped="true"
                 Elevation="4"
                 Items="@BasketOrderLinesDto!.lines"
                 SortMode="@SortMode.Single"
                 DragDropColumnReordering="true"
                 ApplyDropClassesOnDragStarted="true"
                 DragIndicatorIcon="@Icons.Material.Filled.DragIndicator"
                 ColumnsPanelReordering="true"
                 ShowMenuIcon="true"
                 Hideable="true"
                 @ondblclick="(args => HandleRowDoubleClick(args, dataGrid.SelectedItem))"
                 SelectedItemsChanged="@SelectedItemsChanged"
                 EditMode="@DataGridEditMode.Cell"
                 ReadOnly="false"> 
        <Columns>
            <SelectColumn T="BasketLineDto" Size="Size.Small" />
            <HierarchyColumn T="BasketLineDto" />
            <PropertyColumn Property="x => x.LineNum.Value"
                            Title="Ligne"
                            HeaderClass="header-style"
                            Editable="IsLineNbrEditable"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;" />

            <TemplateColumn Title="not impl" CellClass="pa-1 ma-1" CellStyle="text-align: center; margin: 5% auto; font-size: 12px;">
                <CellTemplate>
                    @{
                        var val = context.Item;
                        if (val.OnOrderQuantity?.Value > 0)
                        {
                            <MudIcon Icon="@Icons.Material.Filled.BackHand" Color="Color.Error" Size="Size.Small" />
                        }
                        if (val.OnOrderQuantity?.Value == 0 && val.PhysicalAvailableQuantity?.Value > 0)
                        {

                        }
                        if (val.OnOrderQuantity?.Value == 0 && val.PhysicalAvailableQuantity?.Value == 0)
                        {
                            <MudIcon Icon="@Icons.Material.Filled.Done" Color="Color.Primary" />
                        }
                    }

                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="x => x.ItemId.Value" Title="CodeArticle"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;"
                            CellClass="pa-1 ma-1"
                            Editable="IsItemIdEditable" />
            <PropertyColumn Property="x => x.Name.Value" Title="Description"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 11px;"
                            CellClass="pa-1 ma-1"
                            Editable="IsNameEditable" />
            <PropertyColumn Property="x => x.InventLocationId.Value " Title="Entrepôt"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;"
                            CellClass="pa-1 ma-1" 
                            Editable="IsInventLocationIdEditable" />
            <PropertyColumn Property="x => x.ItemOnOrderQuantity.Value " Title="Commandé"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;"
                            CellClass="pa-1 ma-1"
                            Editable="false" />
            <PropertyColumn Property="x => x.SalesQuantity.Value" Title="Quantité"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;"
                            CellClass="pa-1 ma-1"
                            Editable="IsSalesQuantityEditable" />
            <PropertyColumn Property="x => x.SalesPrice.Value" Title="Prix Unitaire"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;"
                            CellClass="pa-1 ma-1"
                            Editable="true" />
            <PropertyColumn Property="x => x.DiscountType.Value" Title="Tarification"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;"
                            CellClass="pa-1 ma-1"
                            Editable="IsDiscountTypeEditable" />
            <PropertyColumn Property="x => x.LineAmount.Value" Title="Montant HT"
                            HeaderStyle="text-align: center; margin: 5% auto; font-weight: bold; font-size: 13px;"
                            CellStyle="text-align: center; margin: 5% auto; font-size: 12px;"
                            CellClass="pa-1 ma-1"
                            Editable="IsLineAmountEditable" />
        </Columns>
        <ChildRowContent>

            <MudStack Row="true" Justify="Justify.SpaceBetween">
                <MudPaper Class="pa-3">
                    <MudGrid>
                        <!--Code article-->
                        @if (!FieldUtility.IsHidden(context.Item.ItemId))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="string"
                                              Typo="Typo.body2"
                                              Label="@context.Item.ItemId?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.ItemId)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.ItemId)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.ItemId)"
                                              Value="@context.Item.ItemId?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.ItemId, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }

                        <!--N de ligne-->
                        @if (!FieldUtility.IsHidden(context.Item.LineNum))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="int?"
                                              Typo="Typo.body2"
                                              Label="@context.Item.LineNum?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.LineNum)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.LineNum)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.LineNum)"
                                              Value="@context.Item.LineNum?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.LineNum, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }
                    </MudGrid>
                    <MudGrid>
                        <!--Motif Modif-->
                        @if (!FieldUtility.IsHidden(context.Item.UpdateReason))
                        {
                            <MudItem>
                                <GenericMudSelect Variant="Variant.Outlined"
                                                  T="string"
                                                  @bind-BoundValue="context.Item.UpdateReason.Value"
                                                  @bind-BoundValue:after="(() =>
                                                                    OnValueChange(context.Item.UpdateReason.Value,
                                                                    context.Item,
                                                                    context.Item.UpdateReason,
                                                                    context.Item.LineNum.Value))"
                                                  Field="context.Item.UpdateReason"
                                                  Items="UpdateReasons?.Select(item => item?.Value).ToList()" />
                            </MudItem>
                        }

                        <!--Quantité initiale-->
                        @if (!FieldUtility.IsHidden(context.Item.InitialSalesQuantity))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="int?"
                                              Typo="Typo.body2"
                                              Label="@context.Item.InitialSalesQuantity?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.InitialSalesQuantity)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.InitialSalesQuantity)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.InitialSalesQuantity)"
                                              Value="@context.Item.InitialSalesQuantity?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.InitialSalesQuantity, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }

                    </MudGrid>
                    <MudGrid>
                        <!--Vendu par-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="string"
                                          Typo="Typo.body2"
                                          Label="not implemented"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="string.Empty">
                            </MudTextField>
                        </MudItem>
                        <!--Taux de TVA-->
                        @if (!FieldUtility.IsHidden(context.Item.VatRate))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="decimal?"
                                              Typo="Typo.body2"
                                              Label="@context.Item.VatRate?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.VatRate)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.VatRate)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.VatRate)"
                                              Value="@context.Item.VatRate?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.VatRate, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }

                    </MudGrid>
                    <!--Description-->
                    @if (!FieldUtility.IsHidden(context.Item.Name))
                    {
                        <MudTextField Margin="Margin.Dense"
                                      T="string"
                                      Typo="Typo.body2"
                                      Label="@context.Item.Name?.Name"
                                      Style="font-size: 13px; height:30px;"
                                      Variant="Variant.Outlined"
                                      Required="@FieldUtility.IsRequired(context.Item.Name)"
                                      ReadOnly="@FieldUtility.IsReadOnly(context.Item.Name)"
                                      Disabled="@FieldUtility.IsHidden(context.Item.Name)"
                                      Value="@context.Item.Name?.Value"
                                      ValueChanged="(x => OnValueChange(x, context.Item, context.Item.Name, context.Item.LineNum.Value))">
                        </MudTextField>
                    }

                    <!--Notes de ligne-->
                    <MudGrid>
                        @if (!FieldUtility.IsHidden(context.Item.Note))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="string"
                                              Typo="Typo.body2"
                                              Label="@context?.Item?.Note?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context?.Item.Note)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context?.Item.Note)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.Note)"
                                              Value="@context?.Item?.Note?.Value"
                                              ValueChanged="(x => OnValueChange(x, context?.Item, context?.Item?.Note ?? new () , context?.Item?.LineNum?.Value))">
                                </MudTextField>
                            </MudItem>
                        }

                        <!--icons-->
                        <MudItem>
                            <MudIcon Icon="@Icons.Material.Filled.Done" Color="Color.Primary">
                            </MudIcon>
                        </MudItem>
                    </MudGrid>

                    <!--Information produit-->
                    @if (!FieldUtility.IsHidden(context.Item.ProductInfo))
                    {
                        <MudTextField Margin="Margin.Dense"
                                      T="string"
                                      Typo="Typo.body2"
                                      Label="@context.Item.ProductInfo?.Name"
                                      Style="font-size: 13px; height:30px;"
                                      Variant="Variant.Outlined"
                                      Required="@FieldUtility.IsRequired(context.Item.ProductInfo)"
                                      ReadOnly="@FieldUtility.IsReadOnly(context.Item.ProductInfo)"
                                      Disabled="@FieldUtility.IsHidden(context.Item.ProductInfo)"
                                      Value="@context.Item.ProductInfo?.Value"
                                      ValueChanged="(x => OnValueChange(x, context.Item, context.Item.ProductInfo, context.Item.LineNum.Value))">
                        </MudTextField>
                    }
                </MudPaper>

                <MudPaper Class="pa-3">
                    <MudGrid>
                        <!--Flux Logistique-->
                        @if (!FieldUtility.IsHidden(context.Item.LogisticFlow))
                        {
                            <MudItem>
                                <GenericMudSelect Variant="Variant.Outlined"
                                                  T="string"
                                                  @bind-BoundValue="context.Item.LogisticFlow.Value"
                                                  @bind-BoundValue:after="(() =>
                                                                    OnValueChange(context.Item.LogisticFlow.Value,
                                                                    context.Item,
                                                                    context.Item.LogisticFlow,
                                                                    context.Item.LineNum.Value))"
                                                  Field="context.Item.LogisticFlow"
                                                  Items="LogisticFlows?.Select(item => item?.Value).ToList()" />
                            </MudItem>
                        }

                        <!--Entrepot-->
                        @if (!FieldUtility.IsHidden(context.Item.InventLocationId))
                        {
                            <MudItem>
                                <GenericMudSelect Variant="Variant.Outlined"
                                                  T="string"
                                                  @bind-BoundValue="context.Item.InventLocationId.Value"
                                                  @bind-BoundValue:after="(() =>
                                                                    OnValueChange(context.Item.LogisticFlow.Value,
                                                                    context.Item,
                                                                    context.Item.LogisticFlow,
                                                                    context.Item.LineNum.Value))"
                                                  Field="context.Item.InventLocationId"
                                                  Items="UpdateReasons?.Select(item => item?.Value).ToList()" />
                            </MudItem>
                        }

                    </MudGrid>
                    
                    <MudGrid>
                        <!--Livré maintenant-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.PhysicalAvailableQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.PhysicalAvailableQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                        <!--a livrer plus tard-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.OnOrderQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.OnOrderQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                    </MudGrid>
                    
                    <MudGrid>
                        <!--Quantité/palette-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.PaletteQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.PaletteQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                        <!--Diff Palette-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.QuantityAtPaletteThreshold?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.QuantityAtPaletteThreshold?.Value">
                            </MudTextField>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <!--Type d'article-->
                        @if (!FieldUtility.IsHidden(context.Item.LogisticFlow))
                        {
                            <MudItem>
                                <GenericMudSelect Variant="Variant.Outlined"
                                                  T="string"
                                                  @bind-BoundValue="context.Item.LogisticFlow.Value"
                                                  @bind-BoundValue:after="(() =>
                                                                    OnValueChange(context.Item.LogisticFlow.Value,
                                                                    context.Item,
                                                                    context.Item.LogisticFlow,
                                                                    context.Item.LineNum.Value))"
                                                  Field="context.Item.ItemType"
                                                  Items="UpdateReasons?.Select(item => item?.Value).ToList()" />
                            </MudItem>
                        }

                        <!--Date de liv manuelle-->
                        <MudItem>
                            <MudCheckBox Value="context?.Item?.IsCustomDeliveryDate?.Value"></MudCheckBox>
                        </MudItem>
                        <!--Date de liv-->
                        @if (!FieldUtility.IsHidden(context.Item.DeliveryDate))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="string"
                                              Typo="Typo.body2"
                                              Label="@context.Item.DeliveryDate?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.DeliveryDate)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.DeliveryDate)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.DeliveryDate)"
                                              Value="@context.Item.DeliveryDate?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.DeliveryDate, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }
                        @if (!FieldUtility.IsHidden(context.Item.DeliveryDate))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="string"
                                              Typo="Typo.body2"
                                              Label="@context.Item.DeliveryDate?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.DeliveryDate)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.DeliveryDate)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.DeliveryDate)"
                                              Value="@context.Item.DeliveryDate?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.DeliveryDate, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }
                    </MudGrid>
                    <MudGrid Justify="Justify.FlexStart">
                        <!--Disponible-->
                        <MudItem xs="6">
                            <MudText>Disponible </MudText>
                        </MudItem>

                        <MudItem>
                            <MudText> En attente </MudText>
                        </MudItem>
                    </MudGrid>

                    <MudGrid>
                        <!--Stock total-->
                        <MudItem xs="6">
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.ItemPhysicalInventQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.ItemPhysicalInventQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                        <!--Commandé total-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.ItemOrderedQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.ItemOrderedQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                    </MudGrid>

                    <MudGrid>
                        <!--Stock reservé-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.ItemReservPhysicalQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.ItemReservPhysicalQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                        <!--en commande-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.ItemOnOrderQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.ItemOnOrderQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                    </MudGrid>
                    
                    <MudGrid>
                        <!--Stock Dispo-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.ItemPhysicalAvailableQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.ItemPhysicalAvailableQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                        <!--Commandé Dispo-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="int?"
                                          Typo="Typo.body2"
                                          Label="@context.Item.ItemOrderedAvailableQuantity?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.ItemOrderedAvailableQuantity?.Value">
                            </MudTextField>
                        </MudItem>
                    </MudGrid>
                   
                    <MudGrid>
                        <!--Famille d'appro-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="string"
                                          Typo="Typo.body2"
                                          Label="@context.Item.SupplyFamily?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.SupplyFamily?.Value">
                            </MudTextField>
                        </MudItem>
                        <!--Gestionnaire-->
                        <MudItem>
                            <MudTextField Margin="Margin.Dense"
                                          T="string"
                                          Typo="Typo.body2"
                                          Label="@context.Item.ItemManager?.Name"
                                          Style="font-size: 13px; height:30px;"
                                          Variant="Variant.Outlined"
                                          ReadOnly="true"
                                          Value="@context.Item.ItemManager?.Value">
                            </MudTextField>
                        </MudItem>
                    </MudGrid>
                    <!--Mode de transport-->

                    <MudItem>
                        <MudTextField Margin="Margin.Dense"
                                      T="string"
                                      Typo="Typo.body2"
                                      Label="@context.Item.TransportMode?.Name"
                                      Style="font-size: 13px; height:30px;"
                                      Variant="Variant.Outlined"
                                      ReadOnly="true"
                                      Value="@context.Item.TransportMode?.Value">
                        </MudTextField>
                    </MudItem>


                </MudPaper>
                <MudPaper Class="pa-3">
                    <!--Tarification-->
                    @if (!FieldUtility.IsHidden(context.Item.DiscountType))
                    {
                        <GenericMudSelect Variant="Variant.Outlined"
                                          T="string"
                                          @bind-BoundValue="context.Item.LogisticFlow.Value"
                                          @bind-BoundValue:after="(() =>
                                                                    OnValueChange(context.Item.LogisticFlow.Value,
                                                                    context.Item,
                                                                    context.Item.LogisticFlow,
                                                                    context.Item.LineNum.Value))"
                                          Field="context.Item.DiscountType"
                                          Items="UpdateReasons?.Select(item => item?.Value).ToList()" />
                    }


                    <!--Description-->
                    <MudTextField Margin="Margin.Dense"
                                  T="string"
                                  Typo="Typo.body2"
                                  Label="@context.Item.DiscountDescription?.Name"
                                  Style="font-size: 13px; height:30px;"
                                  Variant="Variant.Outlined"
                                  ReadOnly="true"
                                  Value="@context.Item.DiscountDescription?.Value">
                    </MudTextField>

                    <!--Remise sup-->
                    <MudGrid>
                        @if (!FieldUtility.IsHidden(context.Item.DiscountRate))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="decimal?"
                                              Typo="Typo.body2"
                                              Label="@context.Item.DiscountRate?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.DiscountRate)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.DiscountRate)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.DiscountRate)"
                                              Value="@context.Item.DiscountRate?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.DiscountRate, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }

                        <!--PU HT-->
                        @if (!FieldUtility.IsHidden(context.Item.DiscountPrice))
                        {
                            <MudItem>
                                <MudTextField Margin="Margin.Dense"
                                              T="decimal?"
                                              Typo="Typo.body2"
                                              Label="@context.Item.DiscountPrice?.Name"
                                              Style="font-size: 13px; height:30px;"
                                              Variant="Variant.Outlined"
                                              Required="@FieldUtility.IsRequired(context.Item.DiscountPrice)"
                                              ReadOnly="@FieldUtility.IsReadOnly(context.Item.DiscountPrice)"
                                              Disabled="@FieldUtility.IsHidden(context.Item.DiscountPrice)"
                                              Value="@context.Item.DiscountPrice?.Value"
                                              ValueChanged="(x => OnValueChange(x, context.Item, context.Item.DiscountPrice, context.Item.LineNum.Value))">
                                </MudTextField>
                            </MudItem>
                        }

                    </MudGrid>
                </MudPaper>
            </MudStack>
        </ChildRowContent>
    </MudDataGrid>

</MudContainer>





