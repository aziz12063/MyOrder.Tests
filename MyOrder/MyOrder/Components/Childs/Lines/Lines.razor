@using MyOrder.Store.LinesUseCase
@using static MudBlazor.CategoryTypes
@inherits MyOrder.Components.Common.BaseFluxorComponent<LinesState, FetchLinesAction>

@if (State.Value.IsLoading)
{
    <HeaderElementLoadingSkeleton />
    return;
}
<MudContainer Class="pa-0">
    <MudStack Spacing="2">
        <MudText Typo="Typo.h6" Color="Color.Secondary">Lines</MudText>
        <MudStack Row="true" Spacing="1" StretchItems="StretchItems.Start">
            <MudTooltip Text="Chercher client? -Not Implemented">
                <MudIconButton Icon="@Icons.Material.Filled.Search" Size="Size.Small" />
            </MudTooltip>
            <MudTooltip Text="Copier les informations du client -Not Implemented">
                <MudIconButton Icon="@Icons.Material.Filled.Description" Size="Size.Small" />
            </MudTooltip>
            <MudTooltip Text="Salesforce? -Not Implemented">
                <MudIconButton Icon="@Icons.Material.Filled.Cloud" Size="Size.Small" />
            </MudTooltip>
            <MudTooltip Text="Infos? -Not Implemented">
                <MudIconButton Icon="@Icons.Material.Filled.Info" Size="Size.Small" />
            </MudTooltip>
            <MudTooltip Text="Call? -Not Implemented">
                <MudIconButton Icon="@Icons.Material.Filled.Phone" Size="Size.Small" />
            </MudTooltip>
        </MudStack>
        <!--Grid-->
        <MudDataGrid T="BasketLineDto"
                     MultiSelection="true"
                     Items="@BasketOrderLinesDto!.lines"
                     Filterable="false"
                     SortMode="@SortMode.None"
                     Groupable="false"
                     Bordered="true"
                     Dense="true"
                     Class="my-data-grid"
                     @bind-SelectedItem="@basketLineDto">
            <Columns>
                <SelectColumn T="BasketLineDto" />
                <TemplateColumn>
                    <CellTemplate>
                        @{
                            var val = context.Item;
                            string CodeArticle = val.ItemId.Value;
                            string url = "https://www.raja.fr/a_sku" + CodeArticle + ".html";
                        }
                        <!--Target="blank" to open in a new tab-->
                        <MudIconButton Icon="@Icons.Material.Filled.Link" Href="@url" Target="blank" Color="Color.Primary" />
                    </CellTemplate>
                </TemplateColumn>
                <PropertyColumn Property="x => x.LineNum.Value " Title="Ligne" />

                <TemplateColumn Title="not impl">
                    <CellTemplate>
                        <!--
                             show icon error if OnOrderQuantity.Value > 0
                              show icon ok if OnOrderQuantity.Value = 0
                        -->
                        @{
                            var val = context.Item;
                            if (val.OnOrderQuantity?.Value > 0)
                            {
                                <MudIcon Icon="@Icons.Material.Filled.BackHand" Color="Color.Error" />
                            }
                            if (val.OnOrderQuantity?.Value == 0 && val.PhysicalAvailableQuantity?.Value > 0)
                            {

                            }
                            if (val.OnOrderQuantity?.Value == 0 && val.PhysicalAvailableQuantity?.Value == 0)
                            {
                                <MudIcon Icon="@Icons.Material.Filled.Done" Color="Color.Primary" />
                            }

                        }

                    </CellTemplate>
                </TemplateColumn>
                <PropertyColumn Property="x => x.ItemId.Value" Title="CodeArticle" />
                <PropertyColumn Property="x => x.Name.Value" Title="Description" />
                <PropertyColumn Property="x => x.InventLocationId.Value " Title="Entrepôt" />
                <PropertyColumn Property="x => x.ItemOnOrderQuantity.Value " Title="Commandé" />
                <PropertyColumn Property="x => x.SalesQuantity.Value" Title="Quantité" />
                <PropertyColumn Property="x => x.SalesPrice.Value" Title="Prix Unitaire" />
                <PropertyColumn Property="x => x.DiscountType.Value" Title="Tarification" />
                <PropertyColumn Property="x => x.LineAmount.Value" Title="Montant HT" />

            </Columns>
        </MudDataGrid>

    </MudStack>
    <MudStack Row="true" Spacing="3">
        <MudPaper Class="pa-3">
            <MudTextField Margin="Margin.Dense" T="int?"
                          Variant="Variant.Outlined" Width="200px"
                          Disabled="false"
                          Style="font-size: 13px; height:22px;"
                          Value="@basketLineDto?.LineNum?.Value"></MudTextField>
        </MudPaper>
        <MudPaper Class="pa-3">
            Item 2
        </MudPaper>
        <MudPaper Class="pa-3">
            Item 3
        </MudPaper>
    </MudStack>
</MudContainer>






