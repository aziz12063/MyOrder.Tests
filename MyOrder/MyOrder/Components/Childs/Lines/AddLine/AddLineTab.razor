@using MyOrder.Store.NewLineUseCase

@inherits FluxorComponentBase<NewLineState, FetchNewLineAction>

@if (!Initialized)
{
    <MudProgressLinear Color="Color.Primary"
                       Indeterminate="true" />
    <MudText>Chargement ...</MudText>
    return;
}
else if (_isBusy)
{
    <MudOverlay Visible="_isBusy" ZIndex="9999" LightBackground="true">
        <MudElement HtmlTag="div" Class="d-flex flex-column align-center gap-6" Style="width:512px;">
            <MudProgressCircular Size="Size.Large" Indeterminate="true" />
            <MudText Typo="Typo.subtitle2">Chargement...</MudText>
        </MudElement>
    </MudOverlay>
}

<FetchActionTypeCascadingValue FetchActionTypeValue="FetchActionType">
    <MudGrid Spacing="1" Class="mt-3" Justify="Justify.SpaceEvenly">
        <MudFocusTrap DefaultFocus="DefaultFocus.FirstChild" Disabled="false">

            <MudItem xs="12">
                <MudStack Row="true" AlignItems="AlignItems.Baseline">

                    <GenericTextField @ref="ItemIdField"
                                      Field="NewLine!.ItemId"
                                      OnValueChange="ItemIdValueChangedCallback" />

                    <GenericNumericField Field="NewLine!.SalesQuantity"
                                         Step="NewLine!.MultipleQuantity?.Value"
                                         Min="NewLine!.MultipleQuantity?.Value"
                                         OnKeyDown="EnterPressed" />

                    <MudIcon Icon="@Icons.Material.Filled.Clear" Class="pt-1" Color="Color.Secondary" />

                    <DisplayField Field="NewLine!.SalesPrice" />

                    <MudText Color="Color.Secondary" Typo="Typo.h5">=</MudText>

                    <DisplayField Field="NewLine.LineAmount" />
                </MudStack>
            </MudItem>

            <MudItem xs="12">
                <DisplayField Field="NewLine!.ItemName" />
            </MudItem>
            <MudItem xs="3">
                <GenericCheckBox Field="NewLine!.IsUpselling" />
            </MudItem>
            <MudItem xs="3">
                <GenericNumericField Field="NewLine!.InitialSalesQuantity"
                                     Step="NewLine!.MultipleQuantity?.Value"
                                     Min="NewLine!.MultipleQuantity?.Value"
                                     OnKeyDown="EnterPressed" />
            </MudItem>
            <MudItem xs="6">
                <GenericTextField Field="NewLine!.Note"
                                  OnKeyDown="EnterPressed" />
            </MudItem>
            @*
            Code article //rw required w/ error article non trouvé
            dimensions
            link
            poids/volume
            - actif
            <MudItem xs="12">
            <MudStack Row="true" Justify="Justify.SpaceAround">
            FormuleQ

            </MudStack>
            </MudItem>
            <MudItem xs="12">

            Vente add
            Quantité initiale du client
            notes de ligne

            </MudItem> *@
        </MudFocusTrap>
        <MudItem xs="6">
            <LineStockQuantities BasketLine="NewLine"
                                 LogisticFlows="LogisticFlows" />
        </MudItem>
        <MudItem xs="6">
            <LinePricesQuantities BasketLine="NewLine" />
        </MudItem>
    </MudGrid>
</FetchActionTypeCascadingValue>