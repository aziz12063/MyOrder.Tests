@using System.Text
@using Fluxor
@using MyOrder.Services
@using MyOrder.Store.NewLineUseCase

<MudTextField Class="mt-2" T="string" Lines="20" @bind-Text="@freeText" Variant="Variant.Outlined" />

<MudMessageBox @ref="messageBox"
               Title="Warning">
    <MessageContent>
        @Message;
    </MessageContent>

</MudMessageBox>
@code {
    [Inject]
    IDispatcher dispatcher { get; set; }
    [Inject]
    BasketService? BasketService { get; set; }

    private string? freeText { get; set; }
    private MudMessageBox messageBox;
    private string Message { get; set; }

    public void OnAddFreeTexts()
    {
        var basketId = BasketService?.BasketId;
        var lines = freeText?.Split(new[] { "\r\n", "\r", "\n" }, StringSplitOptions.None);
        if (lines == null)
        {
            Message = "text is null or empty";
            messageBox.ShowAsync();
            return;
        }
        List<string?> freeTexts = lines.Where(line => !string.IsNullOrWhiteSpace(line)).ToList();
        if (freeTexts == null || freeTexts.Count == 0)
        {
            Message = "text contain only white space";
            messageBox.ShowAsync();
            return;
        }
        dispatcher.Dispatch(new PostFreeTextAction(basketId, freeTexts));

    }
}
