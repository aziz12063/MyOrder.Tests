@using MyOrder.Store.BasketItemsUseCase
@using MyOrder.Shared.Dtos.BasketItems
@inherits FluxorComponentBase<OrderedItemsState, FetchOrderedItemsAction>

@if (!Initialized)
{
    <HeaderElementLoadingSkeleton />
    return;
}
<FetchActionTypeCascadingValue FetchActionTypeValue="FetchActionType">
    <!--Grid-->
    <MudDataGrid T="OrderedItemDto"
                 Elevation="0"
                 Bordered="true"
                 Dense="true"
                 Striped="true"
                 FixedHeader="true"
                 Height="50vh"
                 Virtualize="true"
                 Items="OrderedItems"
                 SortMode="@SortMode.None"
                 QuickFilter="QuickFilter">
        <ToolBarContent>
            <FilterItems SearchTextCallback="FilterItemsCallback"
                         FilterInactiveItemsCallback="ToggleBlockedCallback" />
            <MudTooltip Text="Copier les données dans le presse-papiers">
                <MudIconButton Icon="@Icons.Material.Outlined.ContentCopy"
                               OnClick="CopyDataToClipboard" />
            </MudTooltip>
        </ToolBarContent>
        <Columns>

            <PropertyColumn Property="item => item.OrderDate == null ? null : item.OrderDate"
                            Title="Date"
                            Format="d"/>

            <PropertyColumn Property="item => item.CustomerOrderId == null ? string.Empty : item.CustomerOrderId"
                            Title="Réf. Client" />

            <TemplateColumn Title="Code">
                <CellTemplate>
                    <MudTooltip Text="Ajouter cet article">
                        <MudButton Variant="Variant.Text"
                                   DropShadow="true"
                                   Color="Color.Primary"
                                   StartIcon="@Icons.Material.Filled.KeyboardDoubleArrowRight"
                                   OnClick="() => OnItemClick(context.Item)">
                            @context.Item.ItemId
                        </MudButton>
                    </MudTooltip>
                </CellTemplate>
            </TemplateColumn>

            <PropertyColumn Property="item => item.Description == null? string.Empty : item.Description"
                            Title="Description" />

            <PropertyColumn Property="item => item.MultipleQuantity == null ? 0 : item.MultipleQuantity "
                            Title="Vendu par" />

            <PropertyColumn Property="item => item.Quantity != null ? item.Quantity : null"
                            Title="Quantité" />

            <PropertyColumn Property="item => item.Price == null? 0 : item.Price"
                            Title="Prix U"
                            Format="C"/>

            <PropertyColumn Property="item => item.Discount == null? string.Empty : item.Discount"
                            Title="Remise" />

           
            <PropertyColumn Property="item => item.Price == null ? 0 : item.Price * item.Quantity "
                            Title="Montant HT"
                            Format="C"/>

            <PropertyColumn Property="item => item.Status != null ? item.Status : null "
                            Title="Statut" />
        </Columns>
    </MudDataGrid>
</FetchActionTypeCascadingValue>